<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Ally - Download</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base Styles */
        body { margin: 0; padding: 20px; font-family: 'Roboto', sans-serif; background-color: #ffffff; display: flex; justify-content: center; align-items: flex-start; }
        .app-container { max-width: 420px; width: 100%; padding: 16px; box-sizing: border-box; }
        
        /* Header */
        .header { display: flex; align-items: center; margin-bottom: 28px; }
        .logo { width: 72px; height: 72px; border-radius: 50%; margin-right: 16px; flex-shrink: 0; background-color: #f0f0f0; }
        .app-info { line-height: 1.2; }
        .developer-name { font-size: 16px; font-weight: 500; color: #0071e3; margin: 0 0 2px 0; }
        .app-name { font-size: 32px; font-weight: 700; color: #1d1d1f; margin: 0; }
        
        /* Stats */
        .app-stats { display: flex; justify-content: space-between; text-align: center; padding: 0 10px; margin-bottom: 28px; }
        .stat-item h3 { margin: 0 0 4px 0; font-size: 16px; font-weight: 500; color: #1d1d1f; }
        .stat-item p { margin: 0; font-size: 13px; color: #86868b; }
        
        /* Download Row */
        .download-creator-row { display: flex; align-items: center; gap: 16px; margin-bottom: 28px; }
        .download-button { background-color: #0071e3; color: #ffffff; padding: 14px 28px; font-size: 17px; border: none; border-radius: 50px; text-decoration: none; font-weight: 700; white-space: nowrap; transition: background-color 0.3s ease; }
        .creator-info { font-size: 13px; color: #5a5a5a; line-height: 1.3; }
        .creator-info b { color: #1d1d1f; font-weight: 500; }
        
        /* Screenshots */
        .screenshot-container { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .screenshot-container::-webkit-scrollbar { display: none; }
        .screenshot-container img { width: calc(50% - 6px); height: auto; border-radius: 16px; flex-shrink: 0; cursor: pointer; background-color: #f0f0f0; }
        
        /* Notice Section */
        .notice-section {
            margin-top: 28px;
            padding: 16px;
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            border-radius: 12px;
        }
        .notice-section h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            font-weight: 700;
            color: #d48806;
        }
        .notice-section p {
            margin: 0;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            white-space: pre-wrap; /* To preserve line breaks from textarea */
        }

        /* Fullscreen Viewer */
        #fullscreen-viewer { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85); text-align: center; }
        #fullscreen-viewer img { max-width: 90%; max-height: 90%; margin: auto; display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        #close-button { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }
        
        /* Utility */
        .dynamic-content { visibility: hidden; }
    </style>
</head>
<body>

<div class="app-container">
    <!-- Header -->
    <div class="header">
        <img id="logo-img" src="" alt="App Logo" class="logo">
        <div class="app-info">
            <h2 id="developer-name" class="developer-name dynamic-content"> </h2>
            <h1 id="app-name" class="app-name dynamic-content"> </h1>
        </div>
    </div>
    
    <!-- Stats -->
    <div class="app-stats">
        <div class="stat-item"><h3 id="rating" class="dynamic-content"> </h3><p>Rating</p></div>
        <div class="stat-item"><h3 id="downloads" class="dynamic-content"> </h3><p>Downloads</p></div>
        <div class="stat-item"><h3 id="version" class="dynamic-content"> </h3><p>Version</p></div>
    </div>
    
    <!-- Download Row -->
    <div class="download-creator-row">
        <a id="download-button" href="#" class="download-button">Download APK</a>
        <div class="creator-info">Created by<br><b id="creator-name-bottom" class="dynamic-content"> </b></div>
    </div>
    
    <!-- Screenshot Container -->
    <div class="screenshot-container">
        <img id="screenshot1" src="" alt="App Screenshot 1" onclick="openFullscreen(this)" style="display: none;">
        <img id="screenshot2" src="" alt="App Screenshot 2" onclick="openFullscreen(this)" style="display: none;">
    </div>

    <!-- Notice Section -->
    <div id="notice-section" class="notice-section" style="display: none;">
        <h3>Notice</h3>
        <p id="notice-text"></p>
    </div>
</div>

<!-- Fullscreen Viewer -->
<div id="fullscreen-viewer" onclick="closeFullscreen(event)">
    <span id="close-button" onclick="closeFullscreen(event)">&times;</span>
    <img id="fullscreen-image" src="">
</div>

<!-- Scripts -->
<script>
    function openFullscreen(imgElement) { document.getElementById('fullscreen-image').src = imgElement.src; document.getElementById('fullscreen-viewer').style.display = 'block'; }
    function closeFullscreen(event) { if (event.target.id !== 'fullscreen-image') { document.getElementById('fullscreen-viewer').style.display = 'none'; } }
</script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
  apiKey: "AIzaSyCE3FLlTNtLGxZ8-Jmk_EGgSOiCIlij7fQ",
  authDomain: "sagor-77c17.firebaseapp.com",
  databaseURL: "https://sagor-77c17-default-rtdb.firebaseio.com",
  projectId: "sagor-77c17",
  storageBucket: "sagor-77c17.firebasestorage.app",
  messagingSenderId: "1052650803504",
  appId: "1:1052650803504:web:c2e638394a4a2f19c8f8f5"
};

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const dynamicElements = document.querySelectorAll('.dynamic-content');
    const downloadButton = document.getElementById('download-button');

    database.ref('appInfo').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            // Populate all text and image data from Firebase
            document.getElementById('developer-name').textContent = data.developerName || '';
            document.getElementById('app-name').textContent = data.appName || '';
            document.getElementById('rating').textContent = `â­ ${data.rating || ''}`;
            document.getElementById('downloads').textContent = data.downloads || '';
            document.getElementById('version').textContent = data.version || '';
            document.getElementById('creator-name-bottom').textContent = data.developerName || '';
            document.getElementById('logo-img').src = data.logoUrl || '';

            // Screenshots
            const ss1 = document.getElementById('screenshot1');
            const ss2 = document.getElementById('screenshot2');
            if (data.screenshots && data.screenshots.url1) {
                ss1.src = data.screenshots.url1;
                ss1.style.display = 'block';
            }
            if (data.screenshots && data.screenshots.url2) {
                ss2.src = data.screenshots.url2;
                ss2.style.display = 'block';
            }

            // Notice
            const noticeSection = document.getElementById('notice-section');
            if (data.notice && data.notice.trim() !== '') {
                document.getElementById('notice-text').textContent = data.notice;
                noticeSection.style.display = 'block';
            } else {
                noticeSection.style.display = 'none';
            }

            // URLs for the download button logic
            const redirectUrl1 = data.redirectUrl1;
            const redirectUrl2 = data.redirectUrl2;
            const finalApkUrl = data.apkUrl || '#';

            // **UPDATED LOGIC STARTS HERE**
            // Check if both redirect URLs are provided and are not empty strings
            if (redirectUrl1 && redirectUrl1.trim() !== '' && redirectUrl2 && redirectUrl2.trim() !== '') {
                // --- Logic for redirection on first 2 clicks ---
                downloadButton.href = '#'; // Set href to # to handle click via JS
                downloadButton.onclick = function(event) {
                    event.preventDefault(); // Prevent page from jumping to top
                    
                    let clickCount = parseInt(sessionStorage.getItem('downloadClickCount') || 0);
                    clickCount++;
                    sessionStorage.setItem('downloadClickCount', clickCount);

                    if (clickCount === 1) {
                        window.location.href = redirectUrl1;
                    } else if (clickCount === 2) {
                        window.location.href = redirectUrl2;
                    } else {
                        window.location.href = finalApkUrl;
                    }
                };
            } else {
                // --- Logic for direct download if redirect URLs are missing ---
                downloadButton.href = finalApkUrl;
                downloadButton.onclick = null; // Remove any previous complex click handlers
            }
            // **UPDATED LOGIC ENDS HERE**
        }
        
        // Make all content visible after loading
        dynamicElements.forEach(el => {
            el.style.visibility = 'visible';
        });
    });
</script>

</body>
</html>
